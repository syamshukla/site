(()=>{var e={};e.id=740,e.ids=[740],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},50852:e=>{"use strict";e.exports=require("async_hooks")},14300:e=>{"use strict";e.exports=require("buffer")},96206:e=>{"use strict";e.exports=require("console")},6113:e=>{"use strict";e.exports=require("crypto")},67643:e=>{"use strict";e.exports=require("diagnostics_channel")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},41808:e=>{"use strict";e.exports=require("net")},15673:e=>{"use strict";e.exports=require("node:events")},84492:e=>{"use strict";e.exports=require("node:stream")},47261:e=>{"use strict";e.exports=require("node:util")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},4074:e=>{"use strict";e.exports=require("perf_hooks")},77282:e=>{"use strict";e.exports=require("process")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},35356:e=>{"use strict";e.exports=require("stream/web")},71576:e=>{"use strict";e.exports=require("string_decoder")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},29830:e=>{"use strict";e.exports=require("util/types")},71267:e=>{"use strict";e.exports=require("worker_threads")},59796:e=>{"use strict";e.exports=require("zlib")},44653:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>d,originalPathname:()=>p,pages:()=>u,routeModule:()=>m,tree:()=>c});var s=r(67096),a=r(16132),o=r(37284),i=r.n(o),n=r(32564),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);r.d(t,l);let c=["",{children:["stats",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,57170)),"/Users/sam/Documents/DREX_DOCS/personal/src/app/stats/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,27534)),"/Users/sam/Documents/DREX_DOCS/personal/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9291,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],u=["/Users/sam/Documents/DREX_DOCS/personal/src/app/stats/page.tsx"],p="/stats/page",d={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/stats/page",pathname:"/stats",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5093:(e,t,r)=>{Promise.resolve().then(r.bind(r,29480)),Promise.resolve().then(r.bind(r,63029))},63029:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var s=r(53854),a=r(34218),o=r(95020),i=r(4144);let n=()=>{let[e,t]=(0,a.useState)([]);(0,a.useEffect)(()=>{let e=async()=>{try{let e=(0,i.Q2)(),r=(await e).docs.map(e=>({documentName:e.id,data:e.data()})),s=new Map;r.forEach(e=>{let[t,r]=e.documentName.split("_"),a=s.get(t);(!a||new Date(r)>new Date(a.date))&&s.set(t,{...e,date:r})});let a=Array.from(s.values()).map(async e=>{let[t,r]=e.documentName.split("_"),s=(0,o.hJ)(i.DU,"users"),a=(0,o.JU)(s,t),n=await (0,o.QT)(a);if(!n.exists())return console.warn(`User document not found for UID: ${t}. Ignoring from the list.`),null;{let t=n.data();return{pick:e.data,user:t,date:r}}}),n=a.filter(e=>null!==e),l=await Promise.all(n),c=l.filter(e=>null!==e),u=c.map(({uid:e,pick:t,user:r,date:s})=>({uid:e,pick:t,user:r,date:s}));console.log("userDataArray",u),t(u)}catch(e){console.error(e)}};e()},[]);let r=async(e,t)=>{console.log(`Fetching data for ${e}...`);try{let s=`https://api.polygon.io/v1/open-close/${e}/${t}?unadjusted=true&apiKey=0asLfTPzTAe9WSPJHa1CNzp9pvbdhX9h`,a=Date.now();if(r.lastApiCallTimestamp&&a-r.lastApiCallTimestamp<3e4){let e=3e4-(a-r.lastApiCallTimestamp);console.log(`Waiting for ${e} milliseconds before the next API call...`),await new Promise(t=>setTimeout(t,e))}let n=await fetch(s),l=await n.json();console.log("data",l);let c=(0,o.JU)((0,o.hJ)(i.DU,"picks"),`${e}_${t}`),u=await (0,o.QT)(c);if(u.exists()){let t=u.data().stocks,r=t.map(t=>t.ticker===e?{...t,polygonData:l}:t);await (0,o.r7)(c,{stocks:r})}r.lastApiCallTimestamp=a;let p=(l.open-l.high)/l.open;return console.log("percent",p),p}catch(t){throw console.error(`Error fetching data for ${e}:`,t),t}};r.lastApiCallTimestamp=0;let n=async()=>{for(let t of e){for(let s of t.pick.stocks)try{console.log("stock",s),console.log("userData",e);let a=await r(s.ticker,t.date),o=Math.round(1e3*a)/1e3;s.percent||(s.percent=[]),s.percent.push(o),console.log("roundPercent",o),console.log("item",t),await new Promise(e=>setTimeout(e,3e4))}catch(e){console.error(`Error fetching data for ${s.ticker}:`,e)}let s=t.pick.stocks.reduce((e,t)=>{let r=parseFloat(t.percent);return isNaN(r)?e:e+r},0)/5;console.log("overallPercentChange",s);let a=!isNaN(s);if(a){let e=`${t.user.uid}_${t.date}`,r=(0,o.hJ)(i.DU,"picks"),a=(0,o.JU)(r,e);await (0,o.r7)(a,{percent:s}),console.log("Saved to Firebase!!!")}else console.warn("Invalid overallPercentChange. Skipping Firestore update.")}};return(0,a.useEffect)(()=>{n()},[n,e]),s.jsx("div",{className:"flex h-screen flex-col items-center justify-center",children:(0,s.jsxs)("div",{className:"w-96 rounded-lg  p-6 shadow-md",children:[s.jsx("h1",{className:"mb-4 text-2xl font-semibold",children:"Score Board"}),s.jsx("ul",{children:e.map((e,t)=>(0,s.jsxs)("li",{className:"mb-6",children:[(0,s.jsxs)("p",{className:"text-lg font-bold",children:["User: ",e.user.name]}),(0,s.jsxs)("p",{children:["Returns: ",e.pick.percent]})]},t))})]})})}},4144:(e,t,r)=>{"use strict";r.d(t,{DU:()=>c,Q2:()=>p,qe:()=>n});var s=r(22863),a=r(47025),o=r(14743),i=r(95020);let n={apiKey:"AIzaSyBsmk11nprS0cxhK_Sm6MrBkoNrooE4dNU",authDomain:"finword-6cfbb.firebaseapp.com",projectId:"finword-6cfbb",storageBucket:"finword-6cfbb.appspot.com",messagingSenderId:"630700130339",appId:"1:630700130339:web:16943bc524200c344cf196",measurementId:"G-2CNPXRWEZN"},l=(0,s.ZF)(n),c=(0,i.ad)(l);(0,a.IH)(l),new o.hJ,(0,o.v0)();let u=(0,i.ad)(l),p=async()=>{try{let e=(0,i.hJ)(u,"picks"),t=await (0,i.PL)(e);return t}catch(e){throw console.error("Error fetching users count:",e),e}}},57170:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var s=r(4656);r(3542);var a=r(81345),o=r.n(a);let i=o()(()=>r.e(95).then(r.bind(r,61095)),{loadableGenerated:{modules:["/Users/sam/Documents/DREX_DOCS/personal/src/app/stats/page.tsx -> @/components/stats/layout"]},ssr:!1});function n(){return s.jsx("div",{children:s.jsx(i,{})})}},73881:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var s=r(31323);let a=e=>{let t=(0,s.fillMetadataSegment)(".",e.params,"favicon.ico");return[{type:"image/x-icon",sizes:"16x16",url:t+""}]}}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[271,270,323,980,701],()=>r(44653));module.exports=s})();