(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[740],{5492:function(e,t,a){Promise.resolve().then(a.bind(a,9167)),Promise.resolve().then(a.bind(a,3403))},3403:function(e,t,a){"use strict";a.r(t);var o=a(7437),n=a(2265),r=a(4086),c=a(804);t.default=()=>{let[e,t]=(0,n.useState)([]);(0,n.useEffect)(()=>{let e=async()=>{try{let e=(0,c.Q2)(),a=(await e).docs.map(e=>({documentName:e.id,data:e.data()})),o=new Map;a.forEach(e=>{let[t,a]=e.documentName.split("_"),n=o.get(t);(!n||new Date(a)>new Date(n.date))&&o.set(t,{...e,date:a})});let n=Array.from(o.values()).map(async e=>{let[t,a]=e.documentName.split("_"),o=(0,r.hJ)(c.DU,"users"),n=(0,r.JU)(o,t),s=await (0,r.QT)(n);if(!s.exists())return console.warn("User document not found for UID: ".concat(t,". Ignoring from the list.")),null;{let t=s.data();return{pick:e.data,user:t,date:a}}}),s=n.filter(e=>null!==e),l=await Promise.all(s),i=l.filter(e=>null!==e),u=i.map(e=>{let{uid:t,pick:a,user:o,date:n}=e;return{uid:t,pick:a,user:o,date:n}});console.log("userDataArray",u),t(u)}catch(e){console.error(e)}};e()},[]);let a=async(e,t)=>{console.log("Fetching data for ".concat(e,"..."));try{let o="https://api.polygon.io/v1/open-close/".concat(e,"/").concat(t,"?unadjusted=true&apiKey=").concat("0asLfTPzTAe9WSPJHa1CNzp9pvbdhX9h"),n=Date.now();if(a.lastApiCallTimestamp&&n-a.lastApiCallTimestamp<3e4){let e=3e4-(n-a.lastApiCallTimestamp);console.log("Waiting for ".concat(e," milliseconds before the next API call...")),await new Promise(t=>setTimeout(t,e))}let s=await fetch(o),l=await s.json();console.log("data",l);let i=(0,r.JU)((0,r.hJ)(c.DU,"picks"),"".concat(e,"_").concat(t)),u=await (0,r.QT)(i);if(u.exists()){let t=u.data().stocks,a=t.map(t=>t.ticker===e?{...t,polygonData:l}:t);await (0,r.r7)(i,{stocks:a})}a.lastApiCallTimestamp=n;let p=(l.open-l.high)/l.open;return console.log("percent",p),p}catch(t){throw console.error("Error fetching data for ".concat(e,":"),t),t}};a.lastApiCallTimestamp=0;let s=async()=>{for(let t of e){for(let o of t.pick.stocks)try{console.log("stock",o),console.log("userData",e);let n=await a(o.ticker,t.date),r=Math.round(1e3*n)/1e3;o.percent||(o.percent=[]),o.percent.push(r),console.log("roundPercent",r),console.log("item",t),await new Promise(e=>setTimeout(e,3e4))}catch(e){console.error("Error fetching data for ".concat(o.ticker,":"),e)}let o=t.pick.stocks.reduce((e,t)=>{let a=parseFloat(t.percent);return isNaN(a)?e:e+a},0)/5;console.log("overallPercentChange",o);let n=!isNaN(o);if(n){let e="".concat(t.user.uid,"_").concat(t.date),a=(0,r.hJ)(c.DU,"picks"),n=(0,r.JU)(a,e);await (0,r.r7)(n,{percent:o}),console.log("Saved to Firebase!!!")}else console.warn("Invalid overallPercentChange. Skipping Firestore update.")}};return(0,n.useEffect)(()=>{s()},[s,e]),(0,o.jsx)("div",{className:"flex h-screen flex-col items-center justify-center",children:(0,o.jsxs)("div",{className:"w-96 rounded-lg  p-6 shadow-md",children:[(0,o.jsx)("h1",{className:"mb-4 text-2xl font-semibold",children:"Score Board"}),(0,o.jsx)("ul",{children:e.map((e,t)=>(0,o.jsxs)("li",{className:"mb-6",children:[(0,o.jsxs)("p",{className:"text-lg font-bold",children:["User: ",e.user.name]}),(0,o.jsxs)("p",{children:["Returns: ",e.pick.percent]})]},t))})]})})}},804:function(e,t,a){"use strict";a.d(t,{DU:function(){return i},Q2:function(){return p},qe:function(){return s}});var o=a(994),n=a(5073),r=a(8153),c=a(4086);let s={apiKey:"AIzaSyBsmk11nprS0cxhK_Sm6MrBkoNrooE4dNU",authDomain:"finword-6cfbb.firebaseapp.com",projectId:"finword-6cfbb",storageBucket:"finword-6cfbb.appspot.com",messagingSenderId:"630700130339",appId:"1:630700130339:web:16943bc524200c344cf196",measurementId:"G-2CNPXRWEZN"},l=(0,o.ZF)(s),i=(0,c.ad)(l);(0,n.IH)(l),new r.hJ,(0,r.v0)();let u=(0,c.ad)(l),p=async()=>{try{let e=(0,c.hJ)(u,"picks"),t=await (0,c.PL)(e);return t}catch(e){throw console.error("Error fetching users count:",e),e}}}},function(e){e.O(0,[358,487,56,971,472,744],function(){return e(e.s=5492)}),_N_E=e.O()}]);